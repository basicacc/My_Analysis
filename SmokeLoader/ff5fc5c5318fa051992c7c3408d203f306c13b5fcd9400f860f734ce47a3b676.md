I started analyzing the malware for a day, mostly using dynamic analyse tools. Normally the file that is downloaded is around 100kb but after unpacking itself, it is around 30kb. We need to put hardware breakpoint at `0x401ae0` to be able to dynamically debug program. (Note: I also put software breakpoint but after breakpoint hit, I removed it for further analysing).
Also I dumped process to ghidra, so I can do static analysis too. If you check memory in x32dbg or SystemInformer, everything can be Read/Written/Executed. That's why it can rewrite itself.

NOTE: The reason, we must not use software breakpoint is, it modifies malware's code by adding `CC` at start of the assembly code, unpacking the code will cause issues.

![1|100](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_5/11.png?raw=true)

Later analyzing the code, I realized some parts of the executable is still encoded, I let malware execute itself till `0x401BCD` so it can decode these parts, then dumped. Which later, I realized it didn't really decode and check ghidra again for any tips. There it is, code is actually decoding -> executing -> encoding itself. (Polymorphic) Which is why I couldn't do static analyzes:

![1|500](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_5/12.png?raw=true)

What I will actually do is, again execute code but now, I will stop at when the part is executed so I can copy and paste it into my dumped exe file. For example, `0x40410a` etc.

Alright so, I changed bytes of the parts we need for further analyzing. the first function at `0x40410a` is putting functions' address from dlls to uninitialized DATAs:

![1|500](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_5/13.png?raw=true)
(it is longer)

It will not be really hard to rename DATAs in ghidra to function names for static analysis. Which is what I am going to do next.