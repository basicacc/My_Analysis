At the time of writing it is around a day that malicious script appeared in wild. To practice and improve myself I chose this malware.

For now in virustotal, it can be seen that malware is only detected by 9 AVs and the server for downloading second payload (*png* file) is still available to be downloaded. 

Starting with analysis, The file's size is really big but only reason for it was repeat of same 10 lines. 
![1|500](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_4/1.png?raw=true)

Using ASCII table we can replace all occurrences of these variables with their Char values.

At first it looked like it is only repeating same 10 line for increasing file size (to look legit), but one more reason was probably trying to hide obfuscated code. (Maybe not but only good explanation is this)
![1|1000](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_4/2.png?raw=true)

At first it might not make sense but you can obviously same pattern in obfuscated code:
`"‚è≥‡§≤·Éë‚£ø‡ºë‚Ç´·®ë‘øüñ≤·Ö´“å‚ä£·àí»™‚üö"`

and payload use `categorised(ByVal inputText)` function to deobfuscate it. (By removing repeating line)
![1|800](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_4/3.png?raw=true)

In this situation manually writing deobfuscater  would be possible to but, it is waste of time. I just changed `dozens = categorised(dozens)` with `WScript.Echo categorised(dozens)` (Don't forget to only copy necessary parts in new file to avoid running something dangerous). I ran the code using **cscript.exe** to see output in my **cmd**.

![1|800](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_4/4.png?raw=true)

Now to deobfuscate, we need to replace '#' with 'A' and convert base64 to string. Once again instead of using cyberchef I just run powershell code with removing `Invoke-Expression` and beautify it a little bit. This is the code that downloads second file. (png)

![1|800](https://github.com/basicacc/basicacc.github.io/blob/main/My_analysis/Malware_4/5.png?raw=true)

(Will continue)